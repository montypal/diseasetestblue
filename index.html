<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epidemiology Case Files: Disease Detectives</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --success: #27ae60; --danger: #e74c3c; --light: #ecf0f1; --gold: #f1c40f; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        #header { width: 100%; background: var(--primary); color: white; padding: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2); position: sticky; top: 0; display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .container { width: 90%; max-width: 850px; margin-top: 30px; padding-bottom: 50px; }
        .card { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 8px solid var(--secondary); display: block; animation: slideIn 0.4s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        h2 { color: var(--primary); margin-top: 0; display: flex; align-items: center; gap: 10px; border-bottom: 2px solid #eee; padding-bottom: 10px;}
        .category-badge { font-size: 0.5em; background: var(--gold); color: #000; padding: 4px 10px; border-radius: 20px; text-transform: uppercase; letter-spacing: 1px; }
        .scenario { background: #fdfdfd; padding: 25px; border-left: 6px solid var(--secondary); font-size: 1.05em; margin-bottom: 25px; color: #34495e; line-height: 1.8; border-radius: 0 8px 8px 0; box-shadow: inset 0 0 10px rgba(0,0,0,0.02); }
        .question-text { font-weight: bold; color: #2c3e50; font-size: 1.1em; background: #eef2f3; padding: 10px; border-radius: 5px; }
        .input-area { margin: 25px 0; display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        input { padding: 12px; width: 160px; border: 2px solid #ccc; border-radius: 6px; font-size: 1.2em; text-align: center; outline: none; transition: border 0.3s; }
        input:focus { border-color: var(--secondary); }
        button { padding: 12px 28px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 1em; transition: 0.2s; }
        .btn-submit { background: var(--secondary); color: white; }
        .btn-submit:hover { background: #2980b9; }
        .btn-next { background: var(--success); color: white; display: none; width: 100%; margin-top: 20px; font-size: 1.1em; }
        .feedback { margin-top: 25px; padding: 20px; border-radius: 8px; display: none; border: 2px solid transparent; line-height: 1.6; }
        .correct { background: #d4edda; color: #155724; border-color: #c3e6cb; }
        .incorrect { background: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .math-block { display: block; margin-top: 15px; font-family: 'Courier New', monospace; background: rgba(255,255,255,0.6); padding: 10px; border-radius: 4px; border: 1px dashed #999; }
    </style>
</head>
<body>

<div id="header">
    <div style="display: flex; flex-direction: column; align-items: center;">
        <div id="progress-bar-container" style="width: 250px; height: 12px; background: #444; border-radius: 6px; overflow: hidden; margin-bottom: 5px;">
            <div id="progress-bar" style="width: 0%; height: 100%; background: var(--gold); transition: 0.4s;"></div>
        </div>
        <small>Progress: <span id="current-num">0</span> / 40</small>
    </div>
    <div style="text-align: center;">
        <div style="font-size: 1.2em; font-weight: bold;">Score: <span id="score">0</span></div>
        <small>Accuracy: <span id="accuracy">0</span>%</small>
    </div>
</div>

<div class="container" id="container">
    <div class="card" id="start-screen" style="text-align: center;">
        <h1>Disease Detectives Case Files</h1>
        <p>You are joining Dr. Maggie and Dr. Kangin to investigate 40 critical outbreaks. Solve each case using your epidemiological toolkit.</p>
        <p><strong>Rules:</strong> Round all ratios to 2 decimal places. Provide percentages as whole numbers or decimals (e.g., 90.50).</p>
        <button class="btn-submit" onclick="startApp()" style="font-size: 1.4em; padding: 20px 50px;">Begin Shift &rarr;</button>
    </div>
</div>

<script>
const problems = [
    { id: 1, cat: "RR", title: "The Sparkle Emoji Scourge", scenario: "Dr. Maggie is investigating a localized outbreak of 'Emoji Fever' at a digital marketing firm. She hypothesizes that heavy use of 'Sparkle Emojis' in emails leads to cognitive fatigue. Among 215 staff who use the sparkle emoji daily (Exposed), 64 reported symptoms. Among 135 staff who use plain text (Unexposed), 18 reported symptoms.", q: "Calculate the Relative Risk (RR).", ans: 2.23, explain: "ARe = 64/215 (0.2977); ARu = 18/135 (0.1333). RR = 0.2977 / 0.1333 = 2.23." },
    { id: 2, cat: "OR", title: "The Snapchat Syndrome", scenario: "During a city-wide investigation into 'Snapchat Syndrome,' Dr. Alyssa performs a study. Of 280 individuals identified as heavy users of the 'Dog Filter' (Exposed), 105 were diagnosed as cases. In the group of 276 individuals who never used the filter (Unexposed), 31 were cases. Controls (well) are those who didn't get sick in each group.", q: "Calculate the Odds Ratio (OR).", ans: 4.75, explain: "OR = (ad)/(bc) = (105 * 245) / (175 * 31) = 4.741." },
    { id: 3, cat: "RR", title: "The Zoomitis Pandemic", scenario: "Dr. Maggie tracks 'Zoomitis' among 490 workers. 210 workers spent more than 6 hours on camera (Exposed), resulting in 74 cases. 280 workers kept their cameras off (Unexposed), resulting in 16 cases.", q: "Calculate the Relative Risk (RR).", ans: 6.17, explain: "ARe = 74/210 (0.3524); ARu = 16/280 (0.0571). RR = 6.17." },
    { id: 4, cat: "OR", title: "The Hashtag Hiccups", scenario: "Dr. Kangin samples 354 individuals. He finds 120 'Heavy Taggers' (Exposed) and 23 of them have the hiccups (cases). In the group of 234 'Lurkers' (Unexposed), 18 individuals have the hiccups.", q: "Calculate the Odds Ratio (OR).", ans: 2.85, explain: "OR = (23 * 216) / (97 * 18) = 2.85." },
    { id: 5, cat: "RR", title: "Meme Convention Madness", scenario: "At a meme convention of 242 attendees, 90 people ate 'Doge-Toast' (Exposed) and 39 became ill. 152 people ate 'Grumpy-Granola' (Unexposed) and 16 became ill.", q: "Calculate the Relative Risk (RR).", ans: 4.12, explain: "ARe = 39/90 (0.433); ARu = 16/152 (0.105). RR = 4.12." },
    { id: 6, cat: "RR", title: "The Filter Flu", scenario: "Among 150 students using filters daily (Exposed), 49 have Filter Flu. Among 228 students who use 'Natural Mode' (Unexposed), only 5 have the flu.", q: "Calculate the Relative Risk (RR).", ans: 14.90, explain: "ARe = 49/150 (0.3267); ARu = 5/228 (0.0219). RR = 14.90." },
    { id: 7, cat: "OR", title: "The Selfie Syndrome", scenario: "Dr. Alyssa tracks 404 tourists. 250 tourists took more than 20 selfies a day (Exposed), and 64 reported wrist pain. Among 154 who only took scenery photos (Unexposed), 50 reported wrist pain.", q: "Calculate the Odds Ratio (OR).", ans: 0.72, explain: "OR = (64 * 104) / (186 * 50) = 0.72." },
    { id: 8, cat: "RR", title: "The GIF-itis Gloom", scenario: "Among 482 users, 300 primarily communicate via GIFs (Exposed), and 104 report attention span issues. Among 182 who use long-form text (Unexposed), 55 report the same issue.", q: "Calculate the Relative Risk (RR).", ans: 1.15, explain: "ARe = 104/300 (0.3467); ARu = 55/182 (0.3022). RR = 1.15." },
    { id: 9, cat: "OR", title: "The Reel Rash", scenario: "Among 572 students, 400 watch Reels 3+ hours (Exposed), with 57 showing a rash. In the group of 172 who watch long-form YouTube (Unexposed), 42 have the rash.", q: "Calculate the Odds Ratio (OR).", ans: 0.52, explain: "OR = (57 * 130) / (343 * 42) = 0.52." },
    { id: 10, cat: "RR", title: "Story Spots", scenario: "Dr. Kangin studies 472 users. 200 users primarily post 'Stories' (Exposed), and 108 developed Red Eye. 272 users post static images (Unexposed), and 59 developed the condition.", q: "Calculate the Relative Risk (RR).", ans: 2.49, explain: "ARe = 108/200 (0.54); ARu = 59/272 (0.2169). RR = 2.49." },
    { id: 11, cat: "SENS", title: "Comment Cough Screening", scenario: "Dr. Kangin tests 600 people. 120 truly have the disease (Affected). His test correctly identifies 105 of them as positive.", q: "Calculate the Sensitivity of the test.", ans: 0.88, explain: "Sens = 105 / 120 = 0.875." },
    { id: 12, cat: "SPEC", title: "Like-itis Verification", scenario: "Out of 330 participants, 230 are truly healthy. The test correctly identifies 190 of those healthy people as negative.", q: "Calculate the Specificity of the test.", ans: 0.83, explain: "Spec = 190 / 230 = 0.826." },
    { id: 13, cat: "PPV", title: "Viral Vibes Predictive Value", scenario: "Dr. Grace tests 264 people. 112 sick people test positive, and 43 healthy people also test positive.", q: "Calculate the Positive Predictive Value (PPV).", ans: 0.72, explain: "PPV = 112 / (112 + 43) = 0.722." },
    { id: 14, cat: "NPV", title: "The Stream Sneeze Assurance", scenario: "Out of 315 people, 137 are truly healthy and test negative. 29 are truly sick but test negative.", q: "Calculate the Negative Predictive Value (NPV).", ans: 0.83, explain: "NPV = 137 / (137 + 29) = 0.825." },
    { id: 15, cat: "SPEC", title: "Ping Pox Precision", scenario: "176 healthy people are tested. 129 test negative correctly. 47 test positive incorrectly.", q: "Calculate the Specificity of the test.", ans: 0.73, explain: "Spec = 129 / 176 = 0.7329." },
    { id: 16, cat: "SENS", title: "Cloudy Brain Sensitivity", scenario: "120 confirmed sick patients are scanned. The scan is positive for 96 of them.", q: "Calculate the Sensitivity.", ans: 0.80, explain: "Sens = 96 / 120 = 0.80." },
    { id: 17, cat: "PPV", title: "Pixel Pox Rapid Test", scenario: "50 sick people test positive. 31 healthy people also test positive. What is the predictive power of a positive?", q: "Calculate the PPV.", ans: 0.62, explain: "PPV = 50 / (50 + 31) = 0.617." },
    { id: 18, cat: "NPV", title: "Trend Tingles Probability", scenario: "130 healthy people test negative. 31 sick people test negative. If you test negative, how likely are you to be healthy?", q: "Calculate the NPV.", ans: 0.81, explain: "NPV = 130 / (130 + 31) = 0.807." },
    { id: 19, cat: "SPEC", title: "Inbox Infection Specificity", scenario: "140 truly healthy people are tested. 102 test negative correctly.", q: "Calculate the Specificity.", ans: 0.73, explain: "Spec = 102 / 140 = 0.728." },
    { id: 20, cat: "SENS", title: "The Final Filter Test", scenario: "In a group of 50 confirmed Filter Flu cases, the test correctly catches 48.", q: "Calculate the Sensitivity.", ans: 0.96, explain: "Sens = 48 / 50 = 0.96." },
    { id: 21, cat: "VE", title: "Vaxitis-A Protection", scenario: "Vaccinated: 1500 people, 15 sick. Unvaccinated: 500 people, 80 sick.", q: "Calculate Vaccine Efficacy (VE) %.", ans: 93.75, explain: "ARv=0.01; ARu=0.16. VE = ((0.16-0.01)/0.16) * 100." },
    { id: 22, cat: "VE", title: "Vaxitis-2 Trial", scenario: "Vaccinated: 399 people, 7 sick. Unvaccinated: 399 people, 138 sick.", q: "Calculate Vaccine Efficacy (VE) %.", ans: 94.93, explain: "VE = ((0.3459-0.0175)/0.3459) * 100 = 94.93." },
    { id: 23, cat: "VE", title: "Vaxitis-3 Evaluation", scenario: "Vaccinated: 222 people, 9 sick. Unvaccinated: 222 people, 55 sick.", q: "Calculate Vaccine Efficacy (VE) %.", ans: 83.64, explain: "ARv=0.0405; ARu=0.2477. VE=83.64." },
    { id: 24, cat: "VE", title: "Vaxitis-B Barrier", scenario: "Vaccinated: 1000, 20 sick. Unvaccinated: 400, 60 sick.", q: "Calculate Vaccine Efficacy (VE) %.", ans: 86.67, explain: "ARv=0.02; ARu=0.15. VE=86.67." },
    { id: 25, cat: "VE", title: "Vaxitis-C Defense", scenario: "Vaccinated: 500, 5 sick. Unvaccinated: 100, 10 sick.", q: "Calculate Vaccine Efficacy (VE) %.", ans: 90.00, explain: "ARv=0.01; ARu=0.10. VE=90%." },
    { id: 26, cat: "VE", title: "Vaxitis-D Impact", scenario: "Vaccinated: 800, 16 sick. Unvaccinated: 200, 40 sick.", q: "Calculate Vaccine Efficacy (VE) %.", ans: 90.00, explain: "ARv=0.02; ARu=0.20. VE=90%." },
    { id: 27, cat: "VE", title: "Vaxitis-E Results", scenario: "Vaccinated: 600, 12 sick. Unvaccinated: 150, 30 sick.", q: "Calculate Vaccine Efficacy (VE) %.", ans: 90.00, explain: "VE=90%." },
    { id: 28, cat: "VE", title: "Vaxitis-F Trial", scenario: "Vaccinated: 1200, 36 sick. Unvaccinated: 400, 48 sick.", q: "Calculate Vaccine Efficacy (VE) %.", ans: 75.00, explain: "ARv=0.03; ARu=0.12. VE=75%." },
    { id: 29, cat: "VE", title: "Vaxitis-G Strength", scenario: "Vaccinated: 900, 9 sick. Unvaccinated: 300, 45 sick.", q: "Calculate Vaccine Efficacy (VE) %.", ans: 93.33, explain: "VE=93.33%." },
    { id: 30, cat: "VE", title: "Vaxitis-H Study", scenario: "Vaccinated: 750, 15 sick. Unvaccinated: 250, 50 sick.", q: "Calculate Vaccine Efficacy (VE) %.", ans: 90.00, explain: "VE=90%." },
    { id: 31, cat: "HIT", title: "Herditis-X Limit", scenario: "A pathogen has a basic reproduction number (R0) of 6.5.", q: "Calculate the Herd Immunity Threshold (HIT) %.", ans: 84.62, explain: "HIT = 1 - (1/6.5) = 84.62%." },
    { id: 32, cat: "HIT", title: "Herditis-1 Threshold", scenario: "A virus has an R0 of 3.", q: "Calculate the HIT %.", ans: 66.67, explain: "HIT = 1 - (1/3) = 66.67%." },
    { id: 33, cat: "HIT", title: "Herditis-2 Requirement", scenario: "A virus has an R0 of 2.", q: "Calculate the HIT %.", ans: 50.00, explain: "HIT = 1 - (1/2) = 50.00%." },
    { id: 34, cat: "HIT", title: "Measles Surge", scenario: "Measles has an R0 of 18.", q: "Calculate the HIT %.", ans: 94.44, explain: "HIT = 1 - (1/18) = 94.44%." },
    { id: 35, cat: "HIT", title: "Seasonal Flu", scenario: "Seasonal flu strain has an R0 of 1.3.", q: "Calculate the HIT %.", ans: 23.08, explain: "HIT = 1 - (1/1.3) = 23.08%." },
    { id: 36, cat: "LR", title: "Test Alpha Positive", scenario: "Test has Sensitivity: 0.92 and Specificity: 0.78.", q: "Calculate the Positive Likelihood Ratio (LR+).", ans: 4.18, explain: "LR+ = 0.92 / (1 - 0.78) = 4.18." },
    { id: 37, cat: "LR", title: "LRitis Lab", scenario: "Sensitivity: 0.81 and Specificity: 0.75.", q: "Calculate the Positive Likelihood Ratio (LR+).", ans: 3.24, explain: "LR+ = 0.81 / 0.25 = 3.24." },
    { id: 38, cat: "LR", title: "LRitis Negative", scenario: "Sensitivity: 0.81 and Specificity: 0.75.", q: "Calculate the Negative Likelihood Ratio (LR-).", ans: 0.25, explain: "LR- = (1 - 0.81) / 0.75 = 0.253." },
    { id: 39, cat: "LR", title: "Test Beta Plus", scenario: "Sensitivity: 0.95 and Specificity: 0.60.", q: "Calculate the Positive Likelihood Ratio (LR+).", ans: 2.38, explain: "LR+ = 0.95 / 0.40 = 2.375." },
    { id: 40, cat: "LR", title: "Test Beta Minus", scenario: "Sensitivity: 0.95 and Specificity: 0.60.", q: "Calculate the Negative Likelihood Ratio (LR-).", ans: 0.08, explain: "LR- = (1 - 0.95) / 0.60 = 0.083." }
];

let score = 0;
let attempted = 0;
let currentIdx = 0;

function startApp() {
    renderProblem(0);
}

function renderProblem(idx) {
    const p = problems[idx];
    const container = document.getElementById('container');
    container.innerHTML = `
        <div class="card active">
            <h2><span class="category-badge">${p.cat}</span> Case ${p.id}: ${p.title}</h2>
            <div class="scenario">${p.scenario}</div>
            <p class="question-text">${p.q}</p>
            <div class="input-area">
                <input type="number" step="0.01" id="ans-${p.id}" placeholder="0.00" onkeydown="if(event.key==='Enter') check(${p.id}, ${p.ans}, '${p.explain}')">
                <button class="btn-submit" id="submit-${p.id}" onclick="check(${p.id}, ${p.ans}, '${p.explain}')">Submit Findings</button>
                <button class="btn-next" id="next-${p.id}" onclick="nextCase()">Next Case &rarr;</button>
            </div>
            <div id="feed-${p.id}" class="feedback"></div>
        </div>
    `;
    document.getElementById('current-num').innerText = idx + 1;
    document.getElementById('progress-bar').style.width = ((idx + 1) / 40 * 100) + '%';
    document.getElementById(`ans-${p.id}`).focus();
}

function check(id, correct, explain) {
    const input = document.getElementById(`ans-${id}`);
    const feed = document.getElementById(`feed-${id}`);
    const nextBtn = document.getElementById(`next-${id}`);
    const submitBtn = document.getElementById(`submit-${id}`);
    const userVal = parseFloat(input.value);

    if (isNaN(userVal)) return;

    attempted++;
    feed.style.display = 'block';
    
    if (Math.abs(userVal - correct) < 0.021) {
        score++;
        feed.className = 'feedback correct';
        feed.innerHTML = `<strong>SUCCESS.</strong> Case solved accurately. <span class="math-block">Explanation: ${explain}</span>`;
    } else {
        feed.className = 'feedback incorrect';
        feed.innerHTML = `<strong>ERROR.</strong> Investigation stalled. Correct answer: ${correct}. <span class="math-block">Explanation: ${explain}</span>`;
    }

    submitBtn.disabled = true;
    submitBtn.style.opacity = '0.5';
    nextBtn.style.display = 'block';
    updateHeader();
}

function nextCase() {
    currentIdx++;
    if (currentIdx < problems.length) {
        renderProblem(currentIdx);
    } else {
        showFinal();
    }
}

function updateHeader() {
    document.getElementById('score').innerText = score;
    document.getElementById('accuracy').innerText = ((score / attempted) * 100).toFixed(1);
}

function showFinal() {
    const container = document.getElementById('container');
    container.innerHTML = `
        <div class="card active" style="text-align:center; border-top: 8px solid var(--gold);">
            <h2>Investigation Complete!</h2>
            <div style="font-size: 4em; margin: 20px 0;">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
            <p style="font-size:1.2em;">Shift complete. 40 cases handled.</p>
            <div style="background:#eee; padding:20px; border-radius:10px; margin:20px 0;">
                <h3 style="margin:0;">Final Score: ${score} / 40</h3>
                <p style="margin:5px 0;">Accuracy Rate: ${((score / attempted) * 100).toFixed(1)}%</p>
            </div>
            <button class="btn-submit" onclick="location.reload()" style="width:100%;">Restart New Shift</button>
        </div>
    `;
}
</script>

</body>
</html>
