<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epidemiology Case Files: Disease Detectives Edition</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --success: #27ae60; --danger: #e74c3c; --light: #ecf0f1; --gold: #f1c40f; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        #header { width: 100%; background: var(--primary); color: white; padding: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2); position: sticky; top: 0; display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .container { width: 90%; max-width: 800px; margin-top: 30px; padding-bottom: 50px; }
        .card { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: none; border-top: 8px solid var(--secondary); }
        .card.active { display: block; animation: slideIn 0.4s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        h2 { color: var(--primary); margin-top: 0; display: flex; align-items: center; gap: 10px; }
        .category-badge { font-size: 0.5em; background: var(--gold); color: #000; padding: 4px 8px; border-radius: 4px; vertical-align: middle; }
        .scenario { background: #f8f9fa; padding: 20px; border-left: 6px solid var(--secondary); font-style: italic; margin-bottom: 25px; color: #34495e; line-height: 1.6; border-radius: 0 8px 8px 0; }
        .input-area { margin: 25px 0; background: #eee; padding: 20px; border-radius: 8px; }
        input { padding: 12px; width: 140px; border: 2px solid #ccc; border-radius: 6px; font-size: 1.2em; text-align: center; }
        button { padding: 12px 28px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 1em; transition: 0.2s; }
        .btn-submit { background: var(--secondary); color: white; }
        .btn-submit:hover { background: #2980b9; }
        .btn-next { background: var(--success); color: white; display: none; margin-top: 15px; width: 100%; }
        .feedback { margin-top: 25px; padding: 20px; border-radius: 8px; display: none; border: 2px solid transparent; }
        .correct { background: #d4edda; color: #155724; border-color: #c3e6cb; }
        .incorrect { background: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .math { font-family: 'Courier New', Courier, monospace; font-weight: bold; display: block; margin-top: 10px; background: rgba(255,255,255,0.5); padding: 5px; }
    </style>
</head>
<body>

<div id="header">
    <div id="progress-bar-container" style="width: 200px; height: 10px; background: #444; border-radius: 5px; overflow: hidden;">
        <div id="progress-bar" style="width: 2.5%; height: 100%; background: var(--gold); transition: 0.3s;"></div>
    </div>
    <span>Case: <span id="current-num">1</span> / 40</span>
    <span>Score: <span id="score">0</span></span>
    <span>Accuracy: <span id="accuracy">0</span>%</span>
</div>

<div class="container" id="container">
    </div>

<script>
const problems = [
    // SECTION 1: RR & OR (10)
    { id: 1, cat: "RR", title: "The Emoji Fever", scenario: "Dr. Maggie finds that among 215 'Sparkle Emoji' users, 64 got sick. Among 135 'Plain Text' users, 18 got sick.", q: "Calculate the Relative Risk (RR).", ans: 2.23, explain: "ARe = 64/215 (0.2977); ARu = 18/135 (0.1333). RR = 0.2977 / 0.1333 = 2.23." },
    { id: 2, cat: "OR", title: "Snapchat Syndrome", scenario: "Dr. Alyssa studies 556 people. 280 were exposed (105 ill). 276 were unexposed (31 ill).", q: "Calculate the Odds Ratio (OR).", ans: 4.75, explain: "OR = (105 * 245) / (175 * 31) = 25725 / 5425 = 4.741 (rounded to 4.75)." },
    { id: 3, cat: "RR", title: "Zoomitis Delirium", scenario: "Dr. Maggie observes 490 office workers. 210 used Zoom (74 cases). 280 used carrier pigeons (16 cases).", q: "Calculate the Relative Risk (RR).", ans: 6.17, explain: "ARe = 74/210 (0.352); ARu = 16/280 (0.057). RR = 0.352 / 0.057 = 6.17." },
    { id: 4, cat: "OR", title: "Hashtag Hiccups", scenario: "Dr. Kangin suspects tagging causes hiccups. 120 'Taggers' had 23 cases. 234 'Lurkers' had 18 cases.", q: "Calculate the Odds Ratio (OR).", ans: 2.85, explain: "OR = (23 * 216) / (97 * 18) = 4968 / 1746 = 2.85." },
    { id: 5, cat: "RR", title: "Meme Madness", scenario: "At a meme convention, 90 people ate 'Doge-Toast' (39 ill). 152 ate 'Grumpy-Granola' (16 ill).", q: "Calculate the Relative Risk (RR).", ans: 4.12, explain: "ARe = 39/90 (0.433); ARu = 16/152 (0.105). RR = 4.12." },
    { id: 6, cat: "RR", title: "Filter Flu", scenario: "Dr. Grace finds 150 users of 'Beauty Filters' had 49 cases. 228 users of 'Natural Mode' had 5 cases.", q: "Calculate the Relative Risk (RR).", ans: 14.90, explain: "ARe = 49/150 (0.327); ARu = 5/228 (0.022). RR = 14.90." },
    { id: 7, cat: "OR", title: "Selfie Syndrome", scenario: "Dr. Alyssa tracks 404 tourists. 250 took selfies (64 ill). 154 did not (50 ill).", q: "Calculate the Odds Ratio (OR).", ans: 0.72, explain: "OR = (64 * 104) / (186 * 50) = 6656 / 9300 = 0.72." },
    { id: 8, cat: "RR", title: "The GIF-itis Gloom", scenario: "300 users of GIFs had 104 cases. 182 users of still images had 55 cases.", q: "Calculate the Relative Risk (RR).", ans: 1.15, explain: "ARe = 104/300 (0.347); ARu = 55/182 (0.302). RR = 1.15." },
    { id: 9, cat: "OR", title: "Reel Rash", scenario: "Dr. Maggie finds 400 'Reel' watchers had 57 cases. 172 'Long-form' watchers had 42 cases.", q: "Calculate the Odds Ratio (OR).", ans: 0.52, explain: "OR = (57 * 130) / (343 * 42) = 7410 / 14406 = 0.52." },
    { id: 10, cat: "RR", title: "Story Spots", scenario: "200 'Story' posters had 108 cases. 272 'Post' only users had 59 cases.", q: "Calculate the Relative Risk (RR).", ans: 2.49, explain: "ARe = 108/200 (0.54); ARu = 59/272 (0.217). RR = 2.49." },

    // SECTION 2: SENSITIVITY/SPECIFICITY (10)
    { id: 11, cat: "SENS", title: "Comment Cough Test", scenario: "600 total. 120 Truly Sick (105 pos). 480 Truly Healthy (60 pos).", q: "Calculate Sensitivity.", ans: 0.88, explain: "Sens = 105/120 = 0.875 (0.88)." },
    { id: 12, cat: "SPEC", title: "Like-itis Screen", scenario: "330 total. 100 Truly Sick (90 pos). 230 Truly Healthy (40 pos).", q: "Calculate Specificity.", ans: 0.83, explain: "Spec = (230 - 40) / 230 = 190 / 230 = 0.826 (0.83)." },
    { id: 13, cat: "PPV", title: "Viral Vibes Test", scenario: "264 tested. 119 Truly Sick (112 pos). 145 Truly Healthy (43 pos).", q: "Calculate PPV.", ans: 0.72, explain: "PPV = 112 / (112 + 43) = 112 / 155 = 0.722." },
    { id: 14, cat: "NPV", title: "Stream Sneeze Test", scenario: "315 tested. 146 Truly Sick (117 pos). 169 Truly Healthy (32 pos).", q: "Calculate NPV.", ans: 0.83, explain: "TN = 169-32=137; FN = 146-117=29. NPV = 137 / (137 + 29) = 0.825." },
    { id: 15, cat: "SPEC", title: "Ping Pox Probe", scenario: "256 tested. 80 Truly Sick (70 pos). 176 Truly Healthy (47 pos).", q: "Calculate Specificity.", ans: 0.73, explain: "Spec = (176-47)/176 = 129/176 = 0.732." },
    { id: 16, cat: "SENS", title: "Cloudy Brain Scan", scenario: "319 tested. 120 Truly Sick (96 pos). 199 Truly Healthy (36 pos).", q: "Calculate Sensitivity.", ans: 0.80, explain: "Sens = 96/120 = 0.80." },
    { id: 17, cat: "PPV", title: "Pixel Pox Rapid", scenario: "237 tested. 84 Truly Sick (50 pos). 153 Truly Healthy (31 pos).", q: "Calculate PPV.", ans: 0.62, explain: "PPV = 50 / (50 + 31) = 0.617." },
    { id: 18, cat: "NPV", title: "Trend Tingles Check", scenario: "293 tested. 142 Truly Sick (111 pos). 151 Truly Healthy (21 pos).", q: "Calculate NPV.", ans: 0.81, explain: "NPV = 130 / (130 + 31) = 0.807." },
    { id: 19, cat: "SPEC", title: "Inbox Infection Lab", scenario: "222 tested. 82 Truly Sick (66 pos). 140 Truly Healthy (38 pos).", q: "Calculate Specificity.", ans: 0.73, explain: "Spec = 102/140 = 0.728." },
    { id: 20, cat: "SENS", title: "Final Filter Test", scenario: "100 tested. 50 Truly Sick (48 pos). 50 Truly Healthy (2 pos).", q: "Calculate Sensitivity.", ans: 0.96, explain: "Sens = 48/50 = 0.96." },

    // SECTION 3: VACCINE EFFICACY (10)
    { id: 21, cat: "VE", title: "Vaxitis-A", scenario: "Vaccinated: 1500 (15 ill). Unvaccinated: 500 (80 ill).", q: "Calculate VE (%)", ans: 93.75, explain: "ARv=0.01; ARu=0.16. VE=(0.16-0.01)/0.16 = 93.75%." },
    { id: 22, cat: "VE", title: "Vaxitis-2", scenario: "Vaccinated: 399 (7 ill). Unvaccinated: 399 (138 ill).", q: "Calculate VE (%)", ans: 94.93, explain: "ARv=0.0175; ARu=0.3459. VE=94.93%." },
    { id: 23, cat: "VE", title: "Vaxitis-3", scenario: "Vaccinated: 222 (9 ill). Unvaccinated: 222 (55 ill).", q: "Calculate VE (%)", ans: 83.64, explain: "ARv=0.0405; ARu=0.2477. VE=83.64%." },
    { id: 24, cat: "VE", title: "Vaxitis-B", scenario: "Vaccinated: 1000 (20 ill). Unvaccinated: 400 (60 ill).", q: "Calculate VE (%)", ans: 86.67, explain: "ARv=0.02; ARu=0.15. VE=86.67%." },
    { id: 25, cat: "VE", title: "Vaxitis-C", scenario: "Vaccinated: 500 (5 ill). Unvaccinated: 100 (10 ill).", q: "Calculate VE (%)", ans: 90.00, explain: "ARv=0.01; ARu=0.10. VE=90%." },
    { id: 26, cat: "VE", title: "Vaxitis-D", scenario: "Vaccinated: 800 (16 ill). Unvaccinated: 200 (40 ill).", q: "Calculate VE (%)", ans: 90.00, explain: "ARv=0.02; ARu=0.20. VE=90%." },
    { id: 27, cat: "VE", title: "Vaxitis-E", scenario: "Vaccinated: 600 (12 ill). Unvaccinated: 150 (30 ill).", q: "Calculate VE (%)", ans: 90.00, explain: "ARv=0.02; ARu=0.20. VE=90%." },
    { id: 28, cat: "VE", title: "Vaxitis-F", scenario: "Vaccinated: 1200 (36 ill). Unvaccinated: 400 (48 ill).", q: "Calculate VE (%)", ans: 75.00, explain: "ARv=0.03; ARu=0.12. VE=75%." },
    { id: 29, cat: "VE", title: "Vaxitis-G", scenario: "Vaccinated: 900 (9 ill). Unvaccinated: 300 (45 ill).", q: "Calculate VE (%)", ans: 93.33, explain: "ARv=0.01; ARu=0.15. VE=93.33%." },
    { id: 30, cat: "VE", title: "Vaxitis-H", scenario: "Vaccinated: 750 (15 ill). Unvaccinated: 250 (50 ill).", q: "Calculate VE (%)", ans: 90.00, explain: "ARv=0.02; ARu=0.20. VE=90%." },

    // SECTION 4: HERD IMMUNITY (5)
    { id: 31, cat: "HIT", title: "Herditis-X", scenario: "The basic reproduction number (R0) is 6.5.", q: "Calculate HIT (%)", ans: 84.62, explain: "HIT = 1 - (1/6.5) = 84.62%." },
    { id: 32, cat: "HIT", title: "Herditis-1", scenario: "The virus R0 is 3.", q: "Calculate HIT (%)", ans: 66.67, explain: "HIT = 1 - (1/3) = 66.67%." },
    { id: 33, cat: "HIT", title: "Herditis-2", scenario: "The virus R0 is 2.", q: "Calculate HIT (%)", ans: 50.00, explain: "HIT = 1 - (1/2) = 50.00%." },
    { id: 34, cat: "HIT", title: "Measles Surge", scenario: "R0 of measles is 18.", q: "Calculate HIT (%)", ans: 94.44, explain: "HIT = 1 - (1/18) = 94.44%." },
    { id: 35, cat: "HIT", title: "Flu Season", scenario: "R0 of seasonal flu is 1.3.", q: "Calculate HIT (%)", ans: 23.08, explain: "HIT = 1 - (1/1.3) = 23.08%." },

    // SECTION 5: LIKELIHOOD RATIOS (5)
    { id: 36, cat: "LR", title: "Test Alpha", scenario: "Sens: 0.92, Spec: 0.78.", q: "Calculate LR+", ans: 4.18, explain: "LR+ = 0.92 / (1-0.78) = 4.18." },
    { id: 37, cat: "LR", title: "LRitis Lab", scenario: "Sens: 0.81, Spec: 0.75.", q: "Calculate LR+", ans: 3.24, explain: "LR+ = 0.81 / 0.25 = 3.24." },
    { id: 38, cat: "LR", title: "LRitis Negative", scenario: "Sens: 0.81, Spec: 0.75.", q: "Calculate LR-", ans: 0.25, explain: "LR- = (1-0.81) / 0.75 = 0.253." },
    { id: 39, cat: "LR", title: "Test Beta Plus", scenario: "Sens: 0.95, Spec: 0.60.", q: "Calculate LR+", ans: 2.38, explain: "LR+ = 0.95 / 0.40 = 2.375." },
    { id: 40, cat: "LR", title: "Test Beta Minus", scenario: "Sens: 0.95, Spec: 0.60.", q: "Calculate LR-", ans: 0.08, explain: "LR- = (1-0.95) / 0.60 = 0.083." }
];

let score = 0;
let attempted = 0;
let currentIdx = 0;

const container = document.getElementById('container');

function renderProblem(idx) {
    const p = problems[idx];
    const card = document.createElement('div');
    card.className = `card active`;
    card.innerHTML = `
        <h2><span class="category-badge">${p.cat}</span> Case ${p.id}: ${p.title}</h2>
        <div class="scenario">${p.scenario}</div>
        <p><strong>${p.q}</strong></p>
        <div class="input-area">
            <input type="number" step="0.01" id="ans-${p.id}" placeholder="0.00">
            <button class="btn-submit" id="submit-${p.id}" onclick="check(${p.id}, ${p.ans}, '${p.explain}')">Submit Case File</button>
            <button class="btn-next" id="next-${p.id}" onclick="nextCase()">Next Case &rarr;</button>
        </div>
        <div id="feed-${p.id}" class="feedback"></div>
    `;
    container.innerHTML = '';
    container.appendChild(card);
}

function check(id, correct, explain) {
    const input = document.getElementById(`ans-${id}`);
    const feed = document.getElementById(`feed-${id}`);
    const nextBtn = document.getElementById(`next-${id}`);
    const submitBtn = document.getElementById(`submit-${id}`);
    const userVal = parseFloat(input.value);

    attempted++;
    feed.style.display = 'block';
    
    // Tolerance of 0.02 for rounding
    if (Math.abs(userVal - correct) < 0.02) {
        score++;
        feed.className = 'feedback correct';
        feed.innerHTML = `<strong>Status: SUCCESS.</strong> The data matches! <span class="math">${explain}</span>`;
    } else {
        feed.className = 'feedback incorrect';
        feed.innerHTML = `<strong>Status: CRITICAL ERROR.</strong> Dr. Maggie expected ${correct}. <span class="math">${explain}</span>`;
    }

    submitBtn.disabled = true;
    submitBtn.style.opacity = '0.5';
    nextBtn.style.display = 'block';
    updateHeader();
}

function nextCase() {
    currentIdx++;
    if (currentIdx < problems.length) {
        renderProblem(currentIdx);
        document.getElementById('current-num').innerText = currentIdx + 1;
        document.getElementById('progress-bar').style.width = ((currentIdx + 1) / 40 * 100) + '%';
    } else {
        showFinal();
    }
}

function updateHeader() {
    document.getElementById('score').innerText = score;
    document.getElementById('accuracy').innerText = ((score / attempted) * 100).toFixed(1);
}

function showFinal() {
    container.innerHTML = `
        <div class="card active" style="text-align:center; border-top: 8px solid var(--gold);">
            <h2>Investigation Complete!</h2>
            <div style="font-size: 3em; margin: 20px 0;">üèÜ</div>
            <p>You investigated 40 cases with an accuracy of <strong>${((score / attempted) * 100).toFixed(1)}%</strong>.</p>
            <p>Dr. Maggie and Dr. Kangin are impressed. You are ready for Science Olympiad!</p>
            <button class="btn-submit" onclick="location.reload()">Restart New Shift</button>
        </div>
    `;
}

// Start
renderProblem(0);
</script>

</body>
</html>
